@model SOPACE_MVC.Models.klaim_medis
@{
    ViewBag.Title = "InputClaimMedical";
    Layout = "~/Views/MasterLayout/MasterAdmin.cshtml";
}

@{
    List<SelectListItem> listItems = new List<SelectListItem>();
    listItems.Add(new SelectListItem
    {
        Text = "Rawat Jalan",
        Value = "Rawat Jalan"
    });
    listItems.Add(new SelectListItem
    {
        Text = "Rawat Inap",
        Value = "Rawat Inap"
    });
    listItems.Add(new SelectListItem
    {
        Text = "Kacamata",
        Value = "Kacamata"
    });
}

<div id="page-wrapper">
    <div class="row">
        <div class="col-lg-12" style="margin-top:20px">
            <h1 class="page-header">Input Claim Medical</h1>
        </div>
        <!-- /.col-lg-12 -->
    </div>
    <!-- /.row -->
    <div class="row">
        <div class="panel panel-success">
            <form id="formAdd">
                <div class="panel" style="background-color:lightblue">
                    <div class="form-horizontal" style="margin-top:20px">
                        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                        <div class="form-group">
                            @Html.LabelFor(model => model.NIP, "NIP:", htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-5">
                                @Html.EditorFor(model => model.NIP, new { htmlAttributes = new { @class = "form-control",
                                        placeholder = "Nomor Indentitas Pegawai" } })
                                @Html.ValidationMessageFor(model => model.NIP, "", new { @class = "text-danger" })
                            </div> <label id="lblCheck"></label>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.nama_pasien, "Nama Pasien:", htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-5">
                                @Html.EditorFor(model => model.nama_pasien, new { htmlAttributes = new { @class = "form-control",
                                        placeholder = "Nama Pasien" } })
                                @Html.ValidationMessageFor(model => model.nama_pasien, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.hubungan_pasien, "Hubungan Pasien:", htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-5">
                                @Html.EditorFor(model => model.hubungan_pasien, new { htmlAttributes = new { @class = "form-control",
                                            placeholder = "Hubungan Pasien dengan Anda" } })
                                @Html.ValidationMessageFor(model => model.hubungan_pasien, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.id_tipe, "Tipe Klaim:", htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-3">
                                @Html.HiddenFor(model => model.id_tipe)
                                @Html.DropDownList("TipeKlaim", new SelectList(listItems, "Value", "Text"), "Select Tipe Medis", new
                                    {@class = "form-control", id="TipeKlaim" })
                            </div>
                        </div>


                        <div class="form-group">
                            @Html.LabelFor(model => model.tgl_perawatan, "Tanggal Perawatan:", htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-5">
                                @Html.EditorFor(model => model.tgl_perawatan, new { htmlAttributes = new { @class = "form-control",
                                                                    placeholder = "Tanggal Masuk Rumah Sakit", type= "date" } })
                                @Html.ValidationMessageFor(model => model.tgl_perawatan, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.nama_dokter, "Nama Dokter:", htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-5">
                                @Html.EditorFor(model => model.nama_dokter, new { htmlAttributes = new { @class = "form-control", placeholder = "Nama Dokter" } })
                                @Html.ValidationMessageFor(model => model.nama_dokter, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.alamat_rs, "Alamat:", htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-5">
                                @Html.TextAreaFor(m => m.alamat_rs, new { @class = "form-control", placeholder = "Alamat Lengkap Rumah Sakit / Optik" })
                                @Html.ValidationMessageFor(model => model.alamat_rs, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.no_tlp, "No. Telp:", htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-5">
                                @Html.EditorFor(model => model.no_tlp, new { htmlAttributes = new { @class = "form-control",
                                                    placeholder = "Nomor Telepon (Ex. 021 323xxxx)", maxlength = 12}})
                                @Html.ValidationMessageFor(model => model.no_tlp, "", new { @class = "text-danger" })
                                <span style="color:red" id="pesan1"></span>
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.diagnosa, "Diagnosa:", htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-5">
                                @Html.EditorFor(model => model.diagnosa, new { htmlAttributes = new { @class = "form-control",
                                                    placeholder = "Diagnosa Penyakit" } })
                                @Html.ValidationMessageFor(model => model.diagnosa, "", new { @class = "text-danger" })
                            </div>
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(model => model.total_tagihan, "Total Biaya:", htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-5">
                                @Html.EditorFor(model => model.total_tagihan, new { htmlAttributes = new { @class = "form-control",
                                             placeholder = "Total Biaya Rumah Sakit" } })
                                @Html.ValidationMessageFor(model => model.total_tagihan, "", new { @class = "text-danger" })
                                <span style="color:red" id="pesan2"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-md-offset-2 col-md-10">
                                <input type="submit" value="Add" class="btn btn-success" id="btn_submit" />
                                <input type="button" value="Cancel" class="btn btn-danger"
                                       onclick="location.href='ViewClaimMedical'" />
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
@section Script{
    <script>
        //ketika input total tagihan dengan huruf, akan hilang karena tidak boleh pakai huruf
        $(document).ready(function () {
            $('#total_tagihan').keyup(function () {
                this.value = this.value.replace(/[^0-9.]/g, '');
            });
        });

        //validasi No Telp
        $(document).ready(function () {
            $("#no_tlp").keypress(function (data) {
                if (data.which != 8 && data.which != 0 && (data.which < 48 || data.which > 57)) {
                    $("#pesan1").html("Tidak boleh menggunakan huruf atau simbol").show().fadeOut("slow");
                    return false;
                }
            });
        });

        //validasi Total tagihan
        $(document).ready(function () {
            $("#total_tagihan").keypress(function (data) {
                if (data.which != 8 && data.which != 0 && (data.which < 48 || data.which > 57)) {
                    $("#pesan2").html("Tidak boleh menggunakan huruf atau simbol").show().fadeOut("slow");
                    return false;
                }
            });
        });

        $("#TipeKlaim").on("change", function (value) {
            var valueTipeMedic = value.target.selectedOptions[0].value
            $("#id_tipe").val(valueTipeMedic);
        });

        function refresh() {
            $("#NIP").val("");
            $("#lblCheck").val("");
            $("#html").val("");
            $("#nama_pasien").val("");
            $("#hubungan_pasien").val("");
            $("#TipeKlaim").val("");
            $("#tgl_perawatan").val("");
            $("#nama_dokter").val("");
            $("#alamat_rs").val("");
            $("#no_tlp").val("");
            $("#diagnosa").val("");
            $("#total_tagihan").val("");
        }

        $('#NIP').change(function () {
            $('#lblCheck').html("Checking....");
            $.post('@Url.Action("GetNama","Claim")',
                {
                    id: $("#NIP").val()
                },
                function (data) {
                    if (data == 0) {
                        $('#lblCheck').html('<font color="Red">NIP Tidak Terdaftar</font>');
                        $('#NIP').css("border-color", "red");
                    }
                    else {
                        if (data == 'true') {
                            $('#NIP').css("border-color", "black");
                            $('#lblCheck').html(`<font color="Green">Karyawan Diperbolehkan untuk Klaim Medis</font>`);
                        } else {
                            $('#NIP').css("border-color", "black");
                            $('#lblCheck').html(`<font color="Red">Karyawan Belum Diperbolehkan untuk Klaim Medis</font>`);
                        }
                    }
                });
        });

        $(document).ready(function () {
            $('#formAdd').validate({
                errorClass: 'help-block animation-slideDown',
                errorElement: 'div',
                errorPlacement: function (error, e) {
                    e.parents('.form-group > div').append(error);
                },
                highlight: function (e) {

                    $(e).closest('.form-group').removeClass('has-success has-error').addClass('has-error');
                    $(e).closest('.help-block').remove();
                },
                success: function (e) {
                    e.closest('.form-group').removeClass('has-success has-error');
                    e.closest('.help-block').remove();
                },
                rules: {
                    'NIP': {
                        required: true
                    },

                    'nama_pasien': {
                       required: true,
                    },

                    'TipeKlaim': {
                        required: true,
                    },

                    'tgl_perawatan': {
                        required: true,
                    },

                    'alamat_rs': {
                        required: true,
                    },

                    'no_tlp': {
                        required: true,
                    },

                    'diagnosa': {
                        required: true,
                    },

                    'total_tagihan': {
                        required: true,
                    }
                },
                submitHandler: function (form) { //setelah sukses, data akan dimasukkan ke database
                    //e.preventDefault();
                    let formdata = $(form).serialize();
                    $.ajax({
                            url: '@Url.Action("AddClaim","Claim")',
                            type: 'POST',
                            data: formdata,
                            success: function (data) {
                                alert(data);
                                location.reload();
                            },
                            error: function () {
                                alert("Insert Data Failed");
                            }
                    });
                }
            });
        });

    </script>
}